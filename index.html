<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bintang Baca - Metode Montessori Lengkap</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #fef9f5;
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
            user-select: none;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            /* Fix for mobile height */
            height: 100dvh; 
            width: 100vw;
            overscroll-behavior: none;
        }

        /* Montessori Colors */
        .text-consonant { color: #0ea5e9; }
        .text-vowel { color: #d946ef; }
        
        .bg-syllable-1 { background-color: #fce7f3; border-color: #fbcfe8; }
        .bg-syllable-2 { background-color: #e0f2fe; border-color: #bae6fd; }
        .bg-syllable-3 { background-color: #fef3c7; border-color: #fde68a; } 

        .card {
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            touch-action: manipulation;
        }
        .card:active { transform: scale(0.95); }
        
        .sandpaper-text {
            background: repeating-linear-gradient(45deg, #f3f4f6, #f3f4f6 2px, #ffffff 2px, #ffffff 4px);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            80% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }
        .animate-pop { animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

        @keyframes bounce-small {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-bounce-small { animation: bounce-small 2s infinite; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        #confetti-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 50;
        }

        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .flipped { transform: rotateY(180deg); }
        .perspective-1000 { perspective: 1000px; }
    </style>
</head>
<body class="flex flex-col items-center justify-center text-gray-800 bg-orange-50/50">

    <canvas id="confetti-canvas"></canvas>

    <!-- App Container -->
    <div id="app-container" class="w-full h-full md:h-[90vh] md:w-[600px] md:rounded-[40px] bg-white shadow-none md:shadow-2xl relative overflow-hidden flex flex-col md:border-4 md:border-white md:ring-4 md:ring-orange-50">
        
        <!-- Header (Pastikan ini terlihat setelah login) -->
        <header id="app-header" class="h-16 px-4 md:px-6 bg-white border-b-2 border-orange-50 flex justify-between items-center z-20 shrink-0 hidden w-full">
            <div class="flex items-center gap-2">
                <button id="btn-home" class="p-2 -ml-2 rounded-full hover:bg-orange-50 text-orange-400 transition hidden">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                </button>
                <div class="flex flex-col">
                    <h1 class="text-lg md:text-xl font-bold text-orange-500 leading-tight">Bintang<span class="text-blue-400">Baca</span></h1>
                    <span id="level-indicator" class="text-[9px] md:text-[10px] text-gray-400 font-bold uppercase tracking-wider hidden">Menu Utama</span>
                </div>
            </div>
            <div class="flex items-center gap-1.5 md:gap-2">
                <div id="user-pill" class="bg-blue-50 px-2 py-1 md:px-3 rounded-full flex items-center gap-1 max-w-[80px] md:max-w-none overflow-hidden">
                    <span class="text-xs text-blue-400 font-bold truncate block w-full">üë§ <span id="display-username">Anak</span></span>
                </div>
                <div id="score-pill" class="bg-yellow-100 px-2 py-1 md:px-3 rounded-full flex items-center gap-1 hidden">
                    <span class="text-xs">‚≠ê</span>
                    <span id="score-display" class="font-bold text-yellow-600 text-xs md:text-sm">0</span>
                </div>
                <button id="btn-add" onclick="app.openAddModal()" class="w-8 h-8 md:w-10 md:h-10 rounded-full bg-green-50 text-green-500 hover:bg-green-100 flex items-center justify-center transition" title="Tambah Kata">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                </button>
                <button id="btn-sound" class="w-8 h-8 md:w-10 md:h-10 rounded-full bg-blue-50 text-blue-500 hover:bg-blue-100 flex items-center justify-center transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
                </button>
                <button onclick="app.logout()" class="w-8 h-8 md:w-10 md:h-10 rounded-full bg-red-50 text-red-400 hover:bg-red-100 flex items-center justify-center transition" title="Keluar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                </button>
            </div>
        </header>

        <!-- Main Content Area -->
        <main id="main-content" class="flex-1 relative overflow-y-auto no-scrollbar bg-orange-50/30 w-full h-full">
            
            <!-- VIEW: LOGIN / REGISTER (AUTH) -->
            <div id="view-auth" class="flex flex-col items-center justify-center min-h-full p-6 md:p-8 bg-white/50 backdrop-blur-sm">
                <div class="bg-white p-6 md:p-8 rounded-[2rem] md:rounded-[2.5rem] shadow-xl md:shadow-2xl w-full max-w-sm text-center animate-pop border-4 border-white ring-4 ring-orange-100">
                    <div class="text-5xl md:text-6xl mb-4">ü¶Å</div>
                    <h1 class="text-xl md:text-2xl font-bold text-orange-500 mb-2">Selamat Datang!</h1>
                    <p id="auth-subtitle" class="text-gray-400 text-xs md:text-sm mb-6">Silakan masuk untuk belajar</p>

                    <!-- Register Form -->
                    <div id="form-register" class="hidden space-y-3 md:space-y-4">
                        <div class="text-left">
                            <label class="text-[10px] md:text-xs font-bold text-gray-400 uppercase ml-2">Nama Kamu</label>
                            <input id="reg-name" type="text" placeholder="Masukkan Nama" class="w-full p-3 md:p-4 rounded-2xl bg-gray-50 border-2 border-gray-100 focus:border-orange-300 outline-none font-bold text-gray-700 text-base md:text-lg transition">
                        </div>
                        <div class="text-left">
                            <label class="text-[10px] md:text-xs font-bold text-gray-400 uppercase ml-2">ID Pendaftaran</label>
                            <input id="reg-id" type="password" placeholder="***" class="w-full p-3 md:p-4 rounded-2xl bg-gray-50 border-2 border-gray-100 focus:border-orange-300 outline-none font-bold text-gray-700 text-base md:text-lg transition">
                        </div>
                        <button onclick="app.handleRegister()" class="w-full py-3 md:py-4 bg-orange-400 text-white rounded-2xl font-bold text-lg md:text-xl shadow-lg hover:bg-orange-500 hover:shadow-orange-200 transition transform active:scale-95 mt-4">
                            Daftar Sekarang
                        </button>
                        <p class="text-xs text-gray-400 mt-4">Sudah punya akun? <button onclick="app.toggleAuthMode('login')" class="text-blue-400 font-bold hover:underline">Masuk</button></p>
                    </div>

                    <!-- Login Form -->
                    <div id="form-login" class="hidden space-y-3 md:space-y-4">
                        <div class="bg-blue-50 p-3 md:p-4 rounded-2xl mb-4">
                            <p class="text-blue-400 text-xs md:text-sm font-bold">üëã Halo! Siapa namamu?</p>
                        </div>
                        <div class="text-left">
                            <label class="text-[10px] md:text-xs font-bold text-gray-400 uppercase ml-2">Nama Pengguna</label>
                            <input id="login-name" type="text" placeholder="Ketik namamu..." class="w-full p-3 md:p-4 rounded-2xl bg-gray-50 border-2 border-gray-100 focus:border-blue-300 outline-none font-bold text-gray-700 text-base md:text-lg transition">
                        </div>
                        <button onclick="app.handleLogin()" class="w-full py-3 md:py-4 bg-blue-400 text-white rounded-2xl font-bold text-lg md:text-xl shadow-lg hover:bg-blue-500 hover:shadow-blue-200 transition transform active:scale-95 mt-4">
                            Masuk
                        </button>
                        <p id="login-reset-link" class="text-xs text-gray-400 mt-4 hidden">Bukan akunmu? <button onclick="app.logout(true)" class="text-red-400 font-bold hover:underline">Reset</button></p>
                    </div>
                </div>
            </div>

            <!-- VIEW: MENU UTAMA -->
            <div id="view-menu" class="hidden p-4 md:p-6 pb-24 md:pb-20 flex flex-col gap-3 md:gap-4 min-h-full">
                <div class="text-center py-2 md:py-4 animate-bounce-small">
                    <h2 class="text-lg md:text-xl font-bold text-gray-700">Mau belajar apa?</h2>
                    <p class="text-gray-500 text-[10px] md:text-xs">Pilih tombol di bawah</p>
                </div>

                <div class="grid grid-cols-1 gap-3 pb-safe">
                    <button onclick="app.startLevel('phonics')" class="card bg-white p-3 md:p-4 rounded-2xl md:rounded-3xl border-b-4 border-blue-200 flex items-center gap-3 md:gap-4 hover:bg-blue-50">
                        <div class="w-10 h-10 md:w-12 md:h-12 rounded-xl md:rounded-2xl bg-blue-100 flex items-center justify-center text-xl md:text-2xl">üëÇ</div>
                        <div class="text-left flex-1">
                            <h3 class="font-bold text-base md:text-lg text-gray-800">1. Kenal Bunyi</h3>
                            <p class="text-[10px] md:text-xs text-gray-400">Belajar bunyi a, i, u, e, o</p>
                        </div>
                        <div class="text-blue-300">‚ûú</div>
                    </button>
                    <button onclick="app.startLevel('vowelSeries')" class="card bg-white p-3 md:p-4 rounded-2xl md:rounded-3xl border-b-4 border-yellow-200 flex items-center gap-3 md:gap-4 hover:bg-yellow-50">
                        <div class="w-10 h-10 md:w-12 md:h-12 rounded-xl md:rounded-2xl bg-yellow-100 flex items-center justify-center text-xl md:text-2xl">üó£Ô∏è</div>
                        <div class="text-left flex-1">
                            <h3 class="font-bold text-base md:text-lg text-gray-800">2. Pola Vokal</h3>
                            <p class="text-[10px] md:text-xs text-gray-400">Ba-Bi-Bu-Be-Bo</p>
                        </div>
                        <div class="text-yellow-300">‚ûú</div>
                    </button>
                    <button onclick="app.startLevel('syllables')" class="card bg-white p-3 md:p-4 rounded-2xl md:rounded-3xl border-b-4 border-purple-200 flex items-center gap-3 md:gap-4 hover:bg-purple-50">
                        <div class="w-10 h-10 md:w-12 md:h-12 rounded-xl md:rounded-2xl bg-purple-100 flex items-center justify-center text-xl md:text-2xl">üìö</div>
                        <div class="text-left flex-1">
                            <h3 class="font-bold text-base md:text-lg text-gray-800">3. Suku Kata</h3>
                            <p class="text-[10px] md:text-xs text-gray-400">Ba-ca, Bo-la (2 Suku Kata)</p>
                        </div>
                        <div class="text-purple-300">‚ûú</div>
                    </button>
                    <button onclick="app.startLevel('cvc')" class="card bg-white p-3 md:p-4 rounded-2xl md:rounded-3xl border-b-4 border-red-200 flex items-center gap-3 md:gap-4 hover:bg-red-50">
                        <div class="w-10 h-10 md:w-12 md:h-12 rounded-xl md:rounded-2xl bg-red-100 flex items-center justify-center text-xl md:text-2xl">üçé</div>
                        <div class="text-left flex-1">
                            <h3 class="font-bold text-base md:text-lg text-gray-800">4. Tiga Huruf</h3>
                            <p class="text-[10px] md:text-xs text-gray-400">Jam, Tas, Bis (K-V-K)</p>
                        </div>
                        <div class="text-red-300">‚ûú</div>
                    </button>
                    <button onclick="app.startLevel('trisyllables')" class="card bg-white p-3 md:p-4 rounded-2xl md:rounded-3xl border-b-4 border-indigo-200 flex items-center gap-3 md:gap-4 hover:bg-indigo-50">
                        <div class="w-10 h-10 md:w-12 md:h-12 rounded-xl md:rounded-2xl bg-indigo-100 flex items-center justify-center text-xl md:text-2xl">üö≤</div>
                        <div class="text-left flex-1">
                            <h3 class="font-bold text-base md:text-lg text-gray-800">5. Tiga Suku Kata</h3>
                            <p class="text-[10px] md:text-xs text-gray-400">Se-pe-da, Se-ko-lah</p>
                        </div>
                        <div class="text-indigo-300">‚ûú</div>
                    </button>
                    <button onclick="app.startLevel('spelling')" class="card bg-white p-3 md:p-4 rounded-2xl md:rounded-3xl border-b-4 border-pink-200 flex items-center gap-3 md:gap-4 hover:bg-pink-50">
                        <div class="w-10 h-10 md:w-12 md:h-12 rounded-xl md:rounded-2xl bg-pink-100 flex items-center justify-center text-xl md:text-2xl">üß©</div>
                        <div class="text-left flex-1">
                            <h3 class="font-bold text-base md:text-lg text-gray-800">6. Susun Kata</h3>
                            <p class="text-[10px] md:text-xs text-gray-400">Latihan mengeja kata</p>
                        </div>
                        <div class="text-pink-300">‚ûú</div>
                    </button>
                     <button onclick="app.startLevel('reading')" class="card bg-white p-3 md:p-4 rounded-2xl md:rounded-3xl border-b-4 border-green-200 flex items-center gap-3 md:gap-4 hover:bg-green-50">
                        <div class="w-10 h-10 md:w-12 md:h-12 rounded-xl md:rounded-2xl bg-green-100 flex items-center justify-center text-xl md:text-2xl">üìñ</div>
                        <div class="text-left flex-1">
                            <h3 class="font-bold text-base md:text-lg text-gray-800">7. Kartu Baca</h3>
                            <p class="text-[10px] md:text-xs text-gray-400">Tebak kata dan gambar</p>
                        </div>
                        <div class="text-green-300">‚ûú</div>
                    </button>
                </div>
            </div>

            <!-- VIEW: PHONICS -->
            <div id="view-phonics" class="hidden h-full flex flex-col items-center justify-center p-4 md:p-6 text-center">
                <div id="phonics-card" class="w-56 h-72 md:w-64 md:h-80 bg-[#DEB887] rounded-[2rem] md:rounded-[3rem] p-3 md:p-4 shadow-xl cursor-pointer transform transition active:scale-95 flex items-center justify-center relative border-4 md:border-8 border-[#C19A6B]">
                    <div class="w-full h-full bg-[#fdfbf7] rounded-[1.5rem] md:rounded-[2rem] flex items-center justify-center shadow-inner relative overflow-hidden">
                        <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/paper-fibers.png')]"></div>
                        <span id="phonics-letter" class="text-[100px] md:text-[160px] font-bold text-consonant sandpaper-text select-none relative z-10">a</span>
                    </div>
                </div>
                <div class="absolute bottom-6 md:bottom-8 w-full px-6 md:px-8 flex justify-between max-w-md">
                    <button onclick="app.navPhonics(-1)" class="w-12 h-12 md:w-14 md:h-14 bg-white rounded-full shadow-lg text-gray-400 flex items-center justify-center hover:scale-110 transition">‚óÄ</button>
                    <button onclick="app.navPhonics(1)" class="w-12 h-12 md:w-14 md:h-14 bg-orange-400 text-white rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition">‚ñ∂</button>
                </div>
            </div>

            <!-- VIEW: VOWEL SERIES -->
            <div id="view-vowel-series" class="hidden h-full flex flex-col items-center p-4 md:p-6">
                <div class="flex justify-between items-center w-full mb-4 md:mb-8 bg-white p-2 rounded-xl md:rounded-2xl shadow-sm">
                    <button onclick="app.navVowelSeries(-1)" class="p-2 md:p-3 bg-gray-100 rounded-lg md:rounded-xl hover:bg-gray-200 text-gray-600 transition">‚óÄ</button>
                    <div class="text-center">
                        <span class="text-[10px] md:text-xs text-gray-400 font-bold uppercase">Huruf</span>
                        <h2 id="vs-consonant-title" class="text-2xl md:text-3xl font-bold text-orange-500 uppercase">B</h2>
                    </div>
                    <button onclick="app.navVowelSeries(1)" class="p-2 md:p-3 bg-orange-100 rounded-lg md:rounded-xl hover:bg-orange-200 text-orange-600 transition">‚ñ∂</button>
                </div>
                <div id="vs-container" class="grid grid-cols-2 gap-3 md:gap-4 w-full max-w-sm"></div>
            </div>

            <!-- VIEW: 2 SYLLABLES -->
            <div id="view-syllables" class="hidden h-full flex flex-col items-center pt-4 md:pt-8 px-4">
                <div class="h-32 md:h-40 w-full flex items-center justify-center mb-4 md:mb-6">
                    <div id="syllable-image-container" class="w-24 h-24 md:w-32 md:h-32 bg-white rounded-2xl md:rounded-3xl shadow-lg flex items-center justify-center text-5xl md:text-6xl transition-all duration-500 transform scale-0 opacity-0 border-4 border-white">
                        <span id="syllable-emoji">üçé</span>
                    </div>
                </div>
                <div class="flex gap-2 md:gap-4 items-center justify-center mb-8 md:mb-12">
                    <button id="syl-btn-1" onclick="app.playSyllable(0)" class="card w-28 h-40 md:w-36 md:h-48 rounded-2xl md:rounded-3xl bg-syllable-1 border-b-8 flex items-center justify-center shadow-lg group relative overflow-hidden">
                        <span id="syl-text-1" class="text-5xl md:text-6xl font-bold text-vowel lowercase group-hover:scale-110 transition-transform">ba</span>
                    </button>
                    <button id="syl-btn-2" onclick="app.playSyllable(1)" class="card w-28 h-40 md:w-36 md:h-48 rounded-2xl md:rounded-3xl bg-syllable-2 border-b-8 flex items-center justify-center shadow-lg group relative overflow-hidden">
                        <span id="syl-text-2" class="text-5xl md:text-6xl font-bold text-consonant lowercase group-hover:scale-110 transition-transform">ca</span>
                    </button>
                </div>
                <div class="w-full max-w-xs flex flex-col gap-2 md:gap-3">
                    <button onclick="app.combineSyllables()" class="w-full py-3 md:py-4 bg-orange-400 text-white rounded-xl md:rounded-2xl font-bold text-lg md:text-xl shadow-lg hover:bg-orange-500 transition-all transform active:scale-95 flex items-center justify-center gap-2">
                        <span>Gabung & Baca</span> üó£Ô∏è
                    </button>
                    <button onclick="app.nextSyllableWord()" class="w-full py-2.5 md:py-3 bg-white text-gray-500 rounded-xl md:rounded-2xl font-bold border-2 border-gray-100 hover:bg-gray-50 transition-colors">
                        Kata Selanjutnya ‚ûú
                    </button>
                </div>
            </div>

            <!-- VIEW: 3 SYLLABLES -->
            <div id="view-trisyllables" class="hidden h-full flex flex-col items-center pt-4 md:pt-8 px-2">
                <div class="h-28 md:h-32 w-full flex items-center justify-center mb-2 md:mb-4">
                    <div id="tri-image-container" class="w-24 h-24 md:w-28 md:h-28 bg-white rounded-2xl md:rounded-3xl shadow-lg flex items-center justify-center text-5xl md:text-6xl transition-all duration-500 transform scale-0 opacity-0 border-4 border-white">
                        <span id="tri-emoji">üö≤</span>
                    </div>
                </div>
                
                <!-- 3 Cards Grid -->
                <div class="flex gap-1.5 md:gap-2 items-center justify-center mb-6 md:mb-10 w-full max-w-md">
                    <button id="tri-btn-0" onclick="app.playTrisyllable(0)" class="card flex-1 h-28 md:h-36 rounded-xl md:rounded-2xl bg-syllable-1 border-b-4 md:border-b-8 flex items-center justify-center shadow-md md:shadow-lg group relative overflow-hidden">
                        <span id="tri-text-0" class="text-2xl md:text-4xl font-bold text-vowel lowercase">se</span>
                    </button>
                    <button id="tri-btn-1" onclick="app.playTrisyllable(1)" class="card flex-1 h-28 md:h-36 rounded-xl md:rounded-2xl bg-syllable-2 border-b-4 md:border-b-8 flex items-center justify-center shadow-md md:shadow-lg group relative overflow-hidden">
                        <span id="tri-text-1" class="text-2xl md:text-4xl font-bold text-consonant lowercase">pe</span>
                    </button>
                    <button id="tri-btn-2" onclick="app.playTrisyllable(2)" class="card flex-1 h-28 md:h-36 rounded-xl md:rounded-2xl bg-syllable-3 border-b-4 md:border-b-8 flex items-center justify-center shadow-md md:shadow-lg group relative overflow-hidden">
                        <span id="tri-text-2" class="text-2xl md:text-4xl font-bold text-orange-500 lowercase">da</span>
                    </button>
                </div>

                <div class="w-full max-w-xs flex flex-col gap-2 md:gap-3">
                    <button onclick="app.combineTrisyllables()" class="w-full py-3 md:py-4 bg-indigo-400 text-white rounded-xl md:rounded-2xl font-bold text-lg md:text-xl shadow-lg hover:bg-indigo-500 transition-all transform active:scale-95 flex items-center justify-center gap-2">
                        <span>Gabung & Baca</span> üó£Ô∏è
                    </button>
                    <button onclick="app.nextTrisyllableWord()" class="w-full py-2.5 md:py-3 bg-white text-gray-500 rounded-xl md:rounded-2xl font-bold border-2 border-gray-100 hover:bg-gray-50 transition-colors">
                        Kata Selanjutnya ‚ûú
                    </button>
                </div>
            </div>

            <!-- VIEW: CVC (TIGA HURUF) -->
            <div id="view-cvc" class="hidden h-full flex flex-col items-center pt-4 md:pt-8 px-4">
                <div class="h-28 md:h-32 w-full flex items-center justify-center mb-4">
                    <div class="w-24 h-24 md:w-28 md:h-28 bg-white rounded-2xl md:rounded-3xl shadow-sm flex items-center justify-center text-5xl md:text-6xl border-2 border-gray-100">
                        <span id="cvc-emoji">üöå</span>
                    </div>
                </div>
                <div class="flex gap-2 items-center justify-center mb-8 md:mb-12">
                    <button onclick="app.playCvcLetter(0)" class="card w-16 h-24 md:w-24 md:h-32 rounded-xl md:rounded-2xl bg-white border-b-4 border-blue-200 flex items-center justify-center shadow-md active:bg-blue-50">
                        <span id="cvc-l1" class="text-4xl md:text-5xl font-bold text-consonant lowercase">b</span>
                    </button>
                    <button onclick="app.playCvcLetter(1)" class="card w-16 h-24 md:w-24 md:h-32 rounded-xl md:rounded-2xl bg-white border-b-4 border-pink-200 flex items-center justify-center shadow-md active:bg-pink-50">
                        <span id="cvc-l2" class="text-4xl md:text-5xl font-bold text-vowel lowercase">i</span>
                    </button>
                    <button onclick="app.playCvcLetter(2)" class="card w-16 h-24 md:w-24 md:h-32 rounded-xl md:rounded-2xl bg-white border-b-4 border-blue-200 flex items-center justify-center shadow-md active:bg-blue-50">
                        <span id="cvc-l3" class="text-4xl md:text-5xl font-bold text-consonant lowercase">s</span>
                    </button>
                </div>
                <div class="w-full max-w-xs flex flex-col gap-2 md:gap-3">
                     <button onclick="app.playCvcWord()" class="w-full py-3 md:py-4 bg-red-400 text-white rounded-xl md:rounded-2xl font-bold text-lg md:text-xl shadow-lg hover:bg-red-500 transition-all transform active:scale-95 flex items-center justify-center gap-2">
                        <span>Baca Kata</span> üîä
                    </button>
                    <div class="flex gap-2">
                        <button onclick="app.navCvc(-1)" class="flex-1 py-2.5 md:py-3 bg-white text-gray-500 rounded-xl md:rounded-2xl font-bold border-2 border-gray-100 hover:bg-gray-50">‚óÄ</button>
                        <button onclick="app.navCvc(1)" class="flex-1 py-2.5 md:py-3 bg-white text-gray-500 rounded-xl md:rounded-2xl font-bold border-2 border-gray-100 hover:bg-gray-50">‚ñ∂</button>
                    </div>
                </div>
            </div>

            <!-- VIEW: SPELLING -->
            <div id="view-spelling" class="hidden h-full flex flex-col">
                <div class="flex-1 flex flex-col items-center justify-center gap-4 md:gap-6 py-4">
                    <div class="w-20 h-20 md:w-28 md:h-28 bg-white rounded-2xl shadow-sm flex items-center justify-center text-5xl md:text-6xl border border-gray-100 animate-pop">
                        <span id="spelling-emoji"></span>
                    </div>
                    <div id="spelling-slots" class="flex gap-1.5 md:gap-2 justify-center flex-wrap px-2 md:px-4"></div>
                </div>
                <div class="bg-white rounded-t-[2rem] md:rounded-t-[2.5rem] shadow-[0_-10px_40px_rgba(0,0,0,0.05)] p-4 md:p-6 z-10">
                    <div id="spelling-keyboard" class="flex flex-wrap justify-center gap-1.5 md:gap-2"></div>
                </div>
            </div>

            <!-- VIEW: READING -->
            <div id="view-reading" class="hidden h-full flex flex-col items-center justify-center p-6">
                <div id="reading-card-container" class="perspective-1000 w-56 h-72 md:w-64 md:h-80 cursor-pointer group" onclick="app.flipReadingCard()">
                    <div id="reading-card-inner" class="relative w-full h-full transition-transform duration-700 transform-style-3d shadow-2xl rounded-[1.5rem] md:rounded-3xl">
                        <div class="absolute w-full h-full backface-hidden bg-white rounded-[1.5rem] md:rounded-3xl flex items-center justify-center border-b-8 border-gray-200 px-2 text-center">
                            <span id="reading-text" class="text-4xl md:text-5xl font-bold text-gray-800 tracking-wide break-words">buku</span>
                            <div class="absolute bottom-6 text-gray-300 text-[10px] md:text-xs uppercase tracking-widest font-bold">Ketuk Kartu</div>
                        </div>
                        <div class="absolute w-full h-full backface-hidden bg-blue-50 rounded-[1.5rem] md:rounded-3xl flex flex-col items-center justify-center border-b-8 border-blue-200 rotate-y-180">
                            <span id="reading-emoji" class="text-7xl md:text-8xl mb-4 drop-shadow-md">üìñ</span>
                            <span class="text-xl md:text-2xl font-bold text-blue-500">Hebat!</span>
                        </div>
                    </div>
                </div>
                <button onclick="app.nextReadingCard()" class="mt-8 md:mt-12 px-6 py-2 md:px-8 md:py-3 bg-white border-2 border-blue-100 text-blue-500 rounded-full font-bold hover:bg-blue-50 transition text-sm md:text-base">
                    Kata Berikutnya ‚ûú
                </button>
            </div>

        </main>
    </div>

    <!-- Add Word Modal -->
    <div id="modal-add" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50 backdrop-blur-sm px-4">
        <div class="bg-white p-5 md:p-6 rounded-[1.5rem] md:rounded-[2rem] shadow-2xl w-full max-w-sm animate-pop relative">
            <button onclick="app.closeAddModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 font-bold text-xl">‚úï</button>
            <h2 class="text-lg md:text-xl font-bold text-gray-700 mb-4 text-center">Tambah Kata Sendiri</h2>
            <div class="space-y-3 md:space-y-4">
                <div>
                    <label class="block text-[10px] md:text-xs font-bold text-gray-400 uppercase mb-1">Kategori</label>
                    <select id="input-category" class="w-full p-2.5 md:p-3 rounded-xl border-2 border-gray-200 bg-gray-50 focus:border-orange-300 outline-none transition font-semibold text-gray-700 text-sm md:text-base">
                        <option value="syllableWords">2 Suku Kata (Contoh: Ba-ca)</option>
                        <option value="trisyllableWords">3 Suku Kata (Contoh: Se-pe-da)</option>
                        <option value="cvcWords">3 Huruf (Contoh: Jam)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-[10px] md:text-xs font-bold text-gray-400 uppercase mb-1">Kata</label>
                    <input id="input-word" type="text" placeholder="Contoh: sapu" class="w-full p-2.5 md:p-3 rounded-xl border-2 border-gray-200 focus:border-orange-300 outline-none transition text-sm md:text-base">
                </div>
                <div id="split-input-group">
                    <label class="block text-[10px] md:text-xs font-bold text-gray-400 uppercase mb-1">Pemenggalan (Pakai tanda -)</label>
                    <input id="input-split" type="text" placeholder="Contoh: sa-pu" class="w-full p-2.5 md:p-3 rounded-xl border-2 border-gray-200 focus:border-orange-300 outline-none transition text-sm md:text-base">
                </div>
                <div>
                    <label class="block text-[10px] md:text-xs font-bold text-gray-400 uppercase mb-1">Emoji (Opsional)</label>
                    <input id="input-emoji" type="text" placeholder="Contoh: üßπ" class="w-full p-2.5 md:p-3 rounded-xl border-2 border-gray-200 focus:border-orange-300 outline-none transition text-sm md:text-base">
                </div>
            </div>
            <button onclick="app.saveCustomWord()" class="w-full py-2.5 md:py-3 bg-green-400 text-white rounded-xl font-bold hover:bg-green-500 shadow-lg mt-5 md:mt-6 transition transform active:scale-95 text-sm md:text-base">Simpan Kata</button>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="modal-feedback" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50 backdrop-blur-sm px-4">
        <div class="bg-white p-6 md:p-8 rounded-[1.5rem] md:rounded-[2rem] shadow-2xl flex flex-col items-center animate-pop max-w-sm w-full text-center">
            <span class="text-6xl md:text-7xl mb-4">üåü</span>
            <h2 class="text-2xl md:text-3xl font-bold text-orange-500 mb-2">Luar Biasa!</h2>
            <button onclick="app.closeModal()" class="w-full py-2.5 md:py-3 bg-orange-400 text-white rounded-xl font-bold hover:bg-orange-500 shadow-lg mt-4 text-sm md:text-base">Lanjut Main</button>
        </div>
    </div>

    <script>
        const gameData = {
            letters: ['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z'],
            consonants: ['b','c','d','f','g','h','j','k','l','m','n','p','q','r','s','t','v','w','x','y','z'],
            // 2 Syllables
            syllableWords: [
                { text: 'baca', split: ['ba','ca'], emoji: 'üìñ' }, { text: 'mama', split: ['ma','ma'], emoji: 'üë©' },
                { text: 'papa', split: ['pa','pa'], emoji: 'üë®' }, { text: 'mata', split: ['ma','ta'], emoji: 'üëÄ' },
                { text: 'kaca', split: ['ka','ca'], emoji: 'ü™û' }, { text: 'buku', split: ['bu','ku'], emoji: 'üìö' },
                { text: 'kuku', split: ['ku','ku'], emoji: 'üíÖ' }, { text: 'susu', split: ['su','su'], emoji: 'ü•õ' },
                { text: 'bola', split: ['bo','la'], emoji: '‚öΩ' }, { text: 'foto', split: ['fo','to'], emoji: 'üì∏' },
                { text: 'sapi', split: ['sa','pi'], emoji: 'üêÑ' }, { text: 'topi', split: ['to','pi'], emoji: 'üé©' },
                { text: 'batu', split: ['ba','tu'], emoji: 'ü™®' }, { text: 'meja', split: ['me','ja'], emoji: 'ü™ë' },
                { text: 'jari', split: ['ja','ri'], emoji: '‚òùÔ∏è' }, { text: 'roti', split: ['ro','ti'], emoji: 'üçû' },
                { text: 'kaki', split: ['ka','ki'], emoji: 'ü¶∂' }, { text: 'baju', split: ['ba','ju'], emoji: 'üëï' },
                { text: 'palu', split: ['pa','lu'], emoji: 'üî®' }, { text: 'rusa', split: ['ru','sa'], emoji: 'ü¶å' }
            ],
            // 3 Syllables
            trisyllableWords: [
                { text: 'sepeda', split: ['se','pe','da'], emoji: 'üö≤' }, { text: 'boneka', split: ['bo','ne','ka'], emoji: 'üß∏' },
                { text: 'kemeja', split: ['ke','me','ja'], emoji: 'üëî' }, { text: 'kelapa', split: ['ke','la','pa'], emoji: 'ü••' },
                { text: 'gurita', split: ['gu','ri','ta'], emoji: 'üêô' }, { text: 'celana', split: ['ce','la','na'], emoji: 'üëñ' },
                { text: 'delima', split: ['de','li','ma'], emoji: 'üçé' }, { text: 'kamera', split: ['ka','me','ra'], emoji: 'üì∑' },
                { text: 'menara', split: ['me','na','ra'], emoji: 'üóº' }, { text: 'pelita', split: ['pe','li','ta'], emoji: 'üïØÔ∏è' },
                { text: 'wanita', split: ['wa','ni','ta'], emoji: 'üë©' }, { text: 'sepatu', split: ['se','pa','tu'], emoji: 'üëü' },
                { text: 'kereta', split: ['ke','re','ta'], emoji: 'üöÇ' }, { text: 'berita', split: ['be','ri','ta'], emoji: 'üì∞' },
                { text: 'cerita', split: ['ce','ri','ta'], emoji: 'üìú' }, { text: 'wisata', split: ['wi','sa','ta'], emoji: 'üèñÔ∏è' },
                { text: 'pidato', split: ['pi','da','to'], emoji: 'üé§' }, { text: 'petani', split: ['pe','ta','ni'], emoji: 'üë®‚Äçüåæ' },
                { text: 'perahu', split: ['pe','ra','hu'], emoji: 'üõ∂' }, { text: 'pepaya', split: ['pe','pa','ya'], emoji: 'üçê' },
                { text: 'bahaya', split: ['ba','ha','ya'], emoji: '‚ö†Ô∏è' }, { text: 'cahaya', split: ['ca','ha','ya'], emoji: 'üí°' },
                { text: 'budaya', split: ['bu','da','ya'], emoji: 'üé≠' }, { text: 'saudara', split: ['sau','da','ra'], emoji: 'ü´Ç' },
                { text: 'udara', split: ['u','da','ra'], emoji: 'üå¨Ô∏è' }, { text: 'kepala', split: ['ke','pa','la'], emoji: 'üë§' },
                { text: 'sekolah', split: ['se','ko','lah'], emoji: 'üè´' }, { text: 'jendela', split: ['jen','de','la'], emoji: 'ü™ü' },
                { text: 'bendera', split: ['ben','de','ra'], emoji: 'üáÆüá©' }, { text: 'kelinci', split: ['ke','lin','ci'], emoji: 'üêá' },
                { text: 'mentega', split: ['men','te','ga'], emoji: 'üßà' }, { text: 'gembira', split: ['gem','bi','ra'], emoji: 'üòÑ' },
                { text: 'kamboja', split: ['kam','bo','ja'], emoji: 'üå∫' }, { text: 'cempaka', split: ['cem','pa','ka'], emoji: 'üåº' },
                { text: 'angkasa', split: ['ang','ka','sa'], emoji: 'üåå' }, { text: 'istana', split: ['is','ta','na'], emoji: 'üè∞' },
                { text: 'pelangi', split: ['pe','la','ngi'], emoji: 'üåà' }, { text: 'sembilan', split: ['sem','bi','lan'], emoji: '9Ô∏è‚É£' },
                { text: 'komputer', split: ['kom','pu','ter'], emoji: 'üíª' }, { text: 'terminal', split: ['ter','mi','nal'], emoji: 'üöå' },
                { text: 'biskuit', split: ['bis','ku','it'], emoji: 'üç™' }, { text: 'stroberi', split: ['stro','be','ri'], emoji: 'üçì' },
                { text: 'tentara', split: ['ten','ta','ra'], emoji: 'üíÇ' }, { text: 'pertama', split: ['per','ta','ma'], emoji: 'ü•á' },
                { text: 'bermain', split: ['ber','ma','in'], emoji: 'ü§π' }, { text: 'berlari', split: ['ber','la','ri'], emoji: 'üèÉ' },
                { text: 'berenang', split: ['ber','e','nang'], emoji: 'üèä' }, { text: 'melukis', split: ['me','lu','kis'], emoji: 'üé®' },
                { text: 'menari', split: ['me','na','ri'], emoji: 'üíÉ' }, { text: 'menyapu', split: ['me','nya','pu'], emoji: 'üßπ' },
                { text: 'gelasku', split: ['ge','las','ku'], emoji: 'ü•õ' }
            ],
            // CVC Words
            cvcWords: [
                { text: 'jam', emoji: 'üï∞Ô∏è' }, { text: 'tas', emoji: 'üéí' }, { text: 'bis', emoji: 'üöå' },
                { text: 'jus', emoji: 'üßÉ' }, { text: 'teh', emoji: 'üçµ' }, { text: 'sup', emoji: 'üç≤' },
                { text: 'rak', emoji: 'üóÑÔ∏è' }, { text: 'rok', emoji: 'üëó' }, { text: 'pot', emoji: 'ü™¥' },
                { text: 'gol', emoji: '‚öΩ' }, { text: 'lem', emoji: 'üß¥' }, { text: 'pel', emoji: 'üßπ' },
                { text: 'pen', emoji: 'üñäÔ∏è' }, { text: 'ban', emoji: 'üõû' }, { text: 'jet', emoji: '‚úàÔ∏è' },
                { text: 'vas', emoji: 'üè∫' }, { text: 'rel', emoji: 'üõ§Ô∏è' }, { text: 'mur', emoji: 'üî©' },
                { text: 'dot', emoji: 'üë∂' }, { text: 'jip', emoji: 'üöô' }, { text: 'pin', emoji: 'üìç' },
                { text: 'map', emoji: 'üìÇ' }, { text: 'net', emoji: 'ü•Ö' }, { text: 'pos', emoji: 'üìÆ' },
                { text: 'bak', emoji: 'üõÅ' }, { text: 'cat', emoji: 'üé®' }, { text: 'bor', emoji: 'üî´' },
                { text: 'lap', emoji: 'üßΩ' }, { text: 'pil', emoji: 'üíä' }, { text: 'gas', emoji: '‚õΩ' }
            ]
        };

        const app = {
            state: {
                currentView: 'auth',
                score: 0,
                soundEnabled: true,
                currentUser: null,
                phonicsIndex: 0,
                vowelSeriesIndex: 0,
                cvcIndex: 0,
                currentWord: null,
                currentSyllableData: null,
                currentTrisyllableData: null,
                spellingInput: [],
                readingFlipped: false,
                voices: [] // To store loaded voices
            },

            init() {
                this.loadCustomWords();
                
                // Initialize voices
                this.loadVoices();
                if (window.speechSynthesis.onvoiceschanged !== undefined) {
                    window.speechSynthesis.onvoiceschanged = () => this.loadVoices();
                }

                this.el = {
                    views: {
                        auth: document.getElementById('view-auth'),
                        menu: document.getElementById('view-menu'),
                        phonics: document.getElementById('view-phonics'),
                        vowelSeries: document.getElementById('view-vowel-series'),
                        syllables: document.getElementById('view-syllables'),
                        trisyllables: document.getElementById('view-trisyllables'),
                        cvc: document.getElementById('view-cvc'),
                        spelling: document.getElementById('view-spelling'),
                        reading: document.getElementById('view-reading')
                    },
                    header: document.getElementById('app-header'),
                    btnHome: document.getElementById('btn-home'),
                    scoreDisplay: document.getElementById('score-display'),
                    scorePill: document.getElementById('score-pill'),
                    userPill: document.getElementById('user-pill'),
                    levelIndicator: document.getElementById('level-indicator'),
                    btnSound: document.getElementById('btn-sound'),
                    btnAdd: document.getElementById('btn-add'),
                    modalAdd: document.getElementById('modal-add'),
                    formLogin: document.getElementById('form-login'),
                    formRegister: document.getElementById('form-register'),
                    authSubtitle: document.getElementById('auth-subtitle'),
                    displayName: document.getElementById('display-username')
                };

                this.el.btnHome.addEventListener('click', () => this.goHome());
                this.el.btnSound.addEventListener('click', () => this.toggleSound());
                
                document.getElementById('input-category').addEventListener('change', (e) => {
                    const splitGroup = document.getElementById('split-input-group');
                    if (e.target.value === 'cvcWords') {
                        splitGroup.classList.add('opacity-50', 'pointer-events-none');
                        document.getElementById('input-split').value = '';
                    } else {
                        splitGroup.classList.remove('opacity-50', 'pointer-events-none');
                    }
                });

                document.getElementById('phonics-card').addEventListener('click', () => {
                    const letter = gameData.letters[this.state.phonicsIndex];
                    this.speak(letter);
                    document.getElementById('phonics-card').classList.add('scale-95');
                    setTimeout(() => document.getElementById('phonics-card').classList.remove('scale-95'), 100);
                });

                this.confettiCtx = document.getElementById('confetti-canvas').getContext('2d');
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());

                this.checkAuth();
            },

            // --- VOICE LOGIC ---
            loadVoices() {
                this.state.voices = window.speechSynthesis.getVoices();
            },

            speak(text, rate = 0.9) {
                if (!this.state.soundEnabled) return;
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Try to find Indonesian voice
                const indoVoice = this.state.voices.find(v => v.lang.includes('id') || v.lang.includes('Indo'));
                if (indoVoice) {
                    utterance.voice = indoVoice;
                }
                
                utterance.lang = 'id-ID';
                utterance.rate = rate;
                utterance.pitch = 1.1;
                window.speechSynthesis.speak(utterance);
            },

            // --- AUTH LOGIC ---
            checkAuth() {
                const registeredUser = localStorage.getItem('bintangBacaUser');
                if (registeredUser) {
                    this.toggleAuthMode('login');
                } else {
                    this.toggleAuthMode('register');
                }
                this.switchView('auth');
            },

            toggleAuthMode(mode) {
                if (mode === 'login') {
                    this.el.formRegister.classList.add('hidden');
                    this.el.formLogin.classList.remove('hidden');
                    this.el.authSubtitle.innerText = "Masukkan namamu untuk mulai";
                    document.getElementById('login-reset-link').classList.remove('hidden');
                } else {
                    this.el.formLogin.classList.add('hidden');
                    this.el.formRegister.classList.remove('hidden');
                    this.el.authSubtitle.innerText = "Daftar dulu yuk!";
                    document.getElementById('login-reset-link').classList.add('hidden');
                }
            },

            handleRegister() {
                const name = document.getElementById('reg-name').value.trim();
                const id = document.getElementById('reg-id').value.trim();

                if (!name) return alert("Silakan isi namamu!");
                if (id !== "123") return alert("ID Salah! Minta bantuan orang tua/guru.");

                localStorage.setItem('bintangBacaUser', name);
                alert(`Halo ${name}! Pendaftaran berhasil. Silakan masuk.`);
                
                // Clear inputs
                document.getElementById('reg-name').value = '';
                document.getElementById('reg-id').value = '';
                
                this.toggleAuthMode('login');
            },

            handleLogin() {
                const inputName = document.getElementById('login-name').value.trim();
                const savedName = localStorage.getItem('bintangBacaUser');

                if (!savedName) {
                    alert("Belum ada akun terdaftar. Silakan daftar dulu.");
                    this.toggleAuthMode('register');
                    return;
                }

                if (inputName.toLowerCase() === savedName.toLowerCase()) {
                    this.state.currentUser = savedName;
                    this.el.displayName.innerText = savedName;
                    
                    // Show header properly on mobile
                    this.el.header.classList.remove('hidden');
                    this.el.header.classList.add('flex');
                    this.goHome();
                } else {
                    alert("Nama salah! Coba lagi ya.");
                }
            },

            logout(reset = false) {
                if (reset) {
                    if(confirm("Hapus data pendaftaran? Kamu harus daftar ulang.")) {
                        localStorage.removeItem('bintangBacaUser');
                        location.reload();
                    }
                } else {
                    this.state.currentUser = null;
                    this.el.header.classList.add('hidden');
                    this.el.header.classList.remove('flex');
                    document.getElementById('login-name').value = '';
                    this.checkAuth();
                }
            },

            // --- CUSTOM WORDS LOGIC ---
            loadCustomWords() {
                const stored = localStorage.getItem('bintangBacaCustom');
                if (stored) {
                    try {
                        const parsed = JSON.parse(stored);
                        if (parsed.syllableWords) gameData.syllableWords.push(...parsed.syllableWords);
                        if (parsed.trisyllableWords) gameData.trisyllableWords.push(...parsed.trisyllableWords);
                        if (parsed.cvcWords) gameData.cvcWords.push(...parsed.cvcWords);
                    } catch (e) { console.error(e); }
                }
            },

            saveCustomWord() {
                const category = document.getElementById('input-category').value;
                const text = document.getElementById('input-word').value.trim().toLowerCase();
                const splitStr = document.getElementById('input-split').value.trim().toLowerCase();
                const emoji = document.getElementById('input-emoji').value.trim() || '‚ú®';

                if (!text) return alert("Mohon isi kata!");
                if (category !== 'cvcWords' && !splitStr) return alert("Mohon isi pemenggalan suku kata!");

                let newItem = { text, emoji };
                if (category !== 'cvcWords') {
                    newItem.split = splitStr.split('-').map(s => s.trim());
                    if (category === 'syllableWords' && newItem.split.length !== 2) return alert("Untuk 2 suku kata, harus ada 2 bagian!");
                    if (category === 'trisyllableWords' && newItem.split.length !== 3) return alert("Untuk 3 suku kata, harus ada 3 bagian!");
                }

                gameData[category].push(newItem);

                let stored = localStorage.getItem('bintangBacaCustom');
                let parsed = stored ? JSON.parse(stored) : { syllableWords: [], trisyllableWords: [], cvcWords: [] };
                
                if (!parsed[category]) parsed[category] = [];
                parsed[category].push(newItem);
                
                localStorage.setItem('bintangBacaCustom', JSON.stringify(parsed));
                alert('Kata berhasil disimpan!');
                this.closeAddModal();
                
                document.getElementById('input-word').value = '';
                document.getElementById('input-split').value = '';
                document.getElementById('input-emoji').value = '';
            },

            openAddModal() {
                this.el.modalAdd.classList.remove('hidden');
                this.el.modalAdd.classList.add('flex');
            },

            closeAddModal() {
                this.el.modalAdd.classList.add('hidden');
                this.el.modalAdd.classList.remove('flex');
            },

            goHome() {
                this.switchView('menu');
                this.el.btnHome.classList.add('hidden');
                this.el.scorePill.classList.add('hidden');
                this.el.levelIndicator.classList.add('hidden');
                this.el.btnAdd.classList.remove('hidden');
            },

            startLevel(level) {
                this.switchView(level);
                this.el.btnHome.classList.remove('hidden');
                this.el.scorePill.classList.remove('hidden');
                this.el.levelIndicator.classList.remove('hidden');
                this.el.btnAdd.classList.add('hidden');
                
                let levelName = "";
                if (level === 'phonics') { levelName = "1. Kenal Bunyi"; this.loadPhonics(); }
                if (level === 'vowelSeries') { levelName = "2. Pola Vokal"; this.loadVowelSeries(); }
                if (level === 'syllables') { levelName = "3. Suku Kata"; this.loadSyllables(); }
                if (level === 'cvc') { levelName = "4. Tiga Huruf (KVK)"; this.loadCvc(); }
                if (level === 'trisyllables') { levelName = "5. Tiga Suku Kata"; this.loadTrisyllables(); }
                if (level === 'spelling') { levelName = "6. Susun Kata"; this.loadSpelling(); }
                if (level === 'reading') { levelName = "7. Kartu Baca"; this.loadReading(); }
                
                this.el.levelIndicator.innerText = levelName;
            },

            switchView(viewId) {
                Object.values(this.el.views).forEach(el => el.classList.add('hidden'));
                this.el.views[viewId].classList.remove('hidden');
                this.state.currentView = viewId;
                window.speechSynthesis.cancel();
            },

            toggleSound() {
                this.state.soundEnabled = !this.state.soundEnabled;
                this.el.btnSound.classList.toggle('opacity-50');
            },

            // --- GAME LOGIC ---
            loadPhonics() {
                const letter = gameData.letters[this.state.phonicsIndex];
                const display = document.getElementById('phonics-letter');
                display.innerText = letter;
                const isVowel = ['a','i','u','e','o'].includes(letter);
                display.className = `text-[100px] md:text-[160px] font-bold sandpaper-text select-none relative z-10 ${isVowel ? 'text-vowel' : 'text-consonant'}`;
                setTimeout(() => this.speak(letter), 400);
            },
            navPhonics(direction) {
                let newIndex = this.state.phonicsIndex + direction;
                if(newIndex >= 0 && newIndex < gameData.letters.length) {
                    this.state.phonicsIndex = newIndex;
                    this.loadPhonics();
                }
            },
            loadVowelSeries() {
                const cons = gameData.consonants[this.state.vowelSeriesIndex];
                document.getElementById('vs-consonant-title').innerText = cons;
                const container = document.getElementById('vs-container');
                container.innerHTML = '';
                const vowels = ['a','i','u','e','o'];
                vowels.forEach(v => {
                    const syllableText = cons + v;
                    const btn = document.createElement('button');
                    const isFullWidth = v === 'o'; 
                    btn.className = `p-3 md:p-4 rounded-xl md:rounded-2xl shadow-md border-b-4 bg-white active:scale-95 transition-all flex flex-col items-center justify-center ${isFullWidth ? 'col-span-2 md:col-span-1' : ''}`;
                    let vowelColor = 'text-gray-700';
                    let borderColor = 'border-gray-200';
                    if(v === 'a') { vowelColor = 'text-red-400'; borderColor = 'border-red-200'; }
                    if(v === 'i') { vowelColor = 'text-yellow-400'; borderColor = 'border-yellow-200'; }
                    if(v === 'u') { vowelColor = 'text-green-400'; borderColor = 'border-green-200'; }
                    if(v === 'e') { vowelColor = 'text-blue-400'; borderColor = 'border-blue-200'; }
                    if(v === 'o') { vowelColor = 'text-orange-400'; borderColor = 'border-orange-200'; }
                    btn.classList.add(borderColor);
                    btn.innerHTML = `<span class="text-3xl md:text-4xl font-bold text-gray-800">${cons}<span class="${vowelColor}">${v}</span></span>`;
                    btn.onclick = () => {
                        this.speak(syllableText);
                        btn.classList.add('scale-95', 'bg-gray-50');
                        setTimeout(() => btn.classList.remove('scale-95', 'bg-gray-50'), 150);
                    };
                    container.appendChild(btn);
                });
            },
            navVowelSeries(direction) {
                let newIndex = this.state.vowelSeriesIndex + direction;
                if(newIndex >= 0 && newIndex < gameData.consonants.length) {
                    this.state.vowelSeriesIndex = newIndex;
                    this.loadVowelSeries();
                }
            },
            loadSyllables() {
                document.getElementById('syllable-image-container').classList.remove('scale-100', 'opacity-100');
                document.getElementById('syllable-image-container').classList.add('scale-0', 'opacity-0');
                const data = gameData.syllableWords[Math.floor(Math.random() * gameData.syllableWords.length)];
                this.state.currentSyllableData = data;
                document.getElementById('syl-text-1').innerText = data.split[0];
                document.getElementById('syl-text-2').innerText = data.split[1];
                document.getElementById('syllable-emoji').innerText = data.emoji;
            },
            playSyllable(index) {
                const text = this.state.currentSyllableData.split[index];
                this.speak(text);
                const btn = document.getElementById(index === 0 ? 'syl-btn-1' : 'syl-btn-2');
                btn.classList.add('scale-95', 'brightness-95');
                setTimeout(() => btn.classList.remove('scale-95', 'brightness-95'), 150);
            },
            combineSyllables() {
                const data = this.state.currentSyllableData;
                if(!this.state.soundEnabled) { this.revealSyllableSuccess(); return; }
                const u1 = new SpeechSynthesisUtterance(data.split[0]); 
                this.applyVoice(u1); u1.rate=0.9;
                
                const u2 = new SpeechSynthesisUtterance(data.split[1]); 
                this.applyVoice(u2); u2.rate=0.9;
                
                const u3 = new SpeechSynthesisUtterance(data.text); 
                this.applyVoice(u3); u3.rate=0.8; u3.pitch=1.2;
                
                u1.onend = () => window.speechSynthesis.speak(u2);
                u2.onend = () => { setTimeout(() => { window.speechSynthesis.speak(u3); this.revealSyllableSuccess(); }, 300); };
                window.speechSynthesis.cancel(); window.speechSynthesis.speak(u1);
            },
            // Helper for apply voice to specific utterances
            applyVoice(utterance) {
                const indoVoice = this.state.voices.find(v => v.lang.includes('id') || v.lang.includes('Indo'));
                if (indoVoice) utterance.voice = indoVoice;
                utterance.lang = 'id-ID';
            },
            revealSyllableSuccess() {
                const imgContainer = document.getElementById('syllable-image-container');
                imgContainer.classList.remove('scale-0', 'opacity-0');
                imgContainer.classList.add('scale-100', 'opacity-100');
                this.fireConfetti();
                this.addScore(10);
            },
            nextSyllableWord() { this.loadSyllables(); },
            loadTrisyllables() {
                document.getElementById('tri-image-container').classList.remove('scale-100', 'opacity-100');
                document.getElementById('tri-image-container').classList.add('scale-0', 'opacity-0');
                
                const data = gameData.trisyllableWords[Math.floor(Math.random() * gameData.trisyllableWords.length)];
                this.state.currentTrisyllableData = data;
                
                document.getElementById('tri-text-0').innerText = data.split[0];
                document.getElementById('tri-text-1').innerText = data.split[1];
                document.getElementById('tri-text-2').innerText = data.split[2];
                document.getElementById('tri-emoji').innerText = data.emoji;
            },
            playTrisyllable(index) {
                const text = this.state.currentTrisyllableData.split[index];
                this.speak(text);
                const btn = document.getElementById(`tri-btn-${index}`);
                btn.classList.add('scale-95', 'brightness-95');
                setTimeout(() => btn.classList.remove('scale-95', 'brightness-95'), 150);
            },
            combineTrisyllables() {
                const data = this.state.currentTrisyllableData;
                if(!this.state.soundEnabled) { this.revealTriSuccess(); return; }
                
                const u1 = new SpeechSynthesisUtterance(data.split[0]); this.applyVoice(u1); u1.rate=1.0;
                const u2 = new SpeechSynthesisUtterance(data.split[1]); this.applyVoice(u2); u2.rate=1.0;
                const u3 = new SpeechSynthesisUtterance(data.split[2]); this.applyVoice(u3); u3.rate=1.0;
                const uFull = new SpeechSynthesisUtterance(data.text); this.applyVoice(uFull); uFull.rate=0.8; uFull.pitch=1.2;

                u1.onend = () => window.speechSynthesis.speak(u2);
                u2.onend = () => window.speechSynthesis.speak(u3);
                u3.onend = () => { 
                    setTimeout(() => { 
                        window.speechSynthesis.speak(uFull); 
                        this.revealTriSuccess(); 
                    }, 200); 
                };
                
                window.speechSynthesis.cancel();
                window.speechSynthesis.speak(u1);
            },
            revealTriSuccess() {
                const imgContainer = document.getElementById('tri-image-container');
                imgContainer.classList.remove('scale-0', 'opacity-0');
                imgContainer.classList.add('scale-100', 'opacity-100');
                this.fireConfetti();
                this.addScore(15);
            },
            nextTrisyllableWord() { this.loadTrisyllables(); },
            loadCvc() {
                const wordObj = gameData.cvcWords[this.state.cvcIndex];
                document.getElementById('cvc-emoji').innerText = wordObj.emoji;
                document.getElementById('cvc-l1').innerText = wordObj.text[0];
                document.getElementById('cvc-l2').innerText = wordObj.text[1];
                document.getElementById('cvc-l3').innerText = wordObj.text[2];
                setTimeout(() => this.speak(wordObj.text), 500);
            },
            navCvc(direction) {
                let newIndex = this.state.cvcIndex + direction;
                if (newIndex < 0) newIndex = gameData.cvcWords.length - 1;
                if (newIndex >= gameData.cvcWords.length) newIndex = 0;
                this.state.cvcIndex = newIndex;
                this.loadCvc();
            },
            playCvcLetter(idx) {
                const word = gameData.cvcWords[this.state.cvcIndex].text;
                this.speak(word[idx]);
            },
            playCvcWord() {
                const word = gameData.cvcWords[this.state.cvcIndex].text;
                this.speak(word);
                this.fireConfetti();
                this.addScore(5);
            },
            loadSpelling() {
                const allWords = [...gameData.syllableWords, ...gameData.cvcWords, ...gameData.trisyllableWords];
                const wordObj = allWords[Math.floor(Math.random() * allWords.length)];
                this.state.currentWord = { text: wordObj.text, emoji: wordObj.emoji, letters: wordObj.text.split('') };
                this.state.spellingInput = Array(this.state.currentWord.letters.length).fill('');
                document.getElementById('spelling-emoji').innerText = this.state.currentWord.emoji;
                this.speak(this.state.currentWord.text);
                const slotsContainer = document.getElementById('spelling-slots');
                slotsContainer.innerHTML = '';
                this.state.currentWord.letters.forEach((_, index) => {
                    const slot = document.createElement('div');
                    const sizeClass = this.state.currentWord.letters.length > 5 ? 'w-8 h-10 md:w-12 md:h-16 text-xl md:text-2xl' : 'w-10 h-12 md:w-16 md:h-20 text-2xl md:text-3xl';
                    slot.className = `${sizeClass} bg-gray-100 border-2 border-gray-300 rounded-lg md:rounded-xl flex items-center justify-center font-bold text-gray-700 cursor-pointer transition`;
                    slot.onclick = () => this.removeSpellingLetter(index);
                    slot.id = `slot-${index}`;
                    slotsContainer.appendChild(slot);
                });
                const keyboard = document.getElementById('spelling-keyboard');
                keyboard.innerHTML = '';
                let pool = [...this.state.currentWord.letters];
                while(pool.length < 10) pool.push(gameData.letters[Math.floor(Math.random() * 26)]);
                pool.sort(() => Math.random() - 0.5);
                pool.forEach(char => {
                    const btn = document.createElement('button');
                    const isVowel = ['a','i','u','e','o'].includes(char);
                    btn.className = `w-9 h-11 md:w-12 md:h-14 rounded-lg md:rounded-xl shadow-[0_3px_0_rgb(0,0,0,0.1)] md:shadow-[0_4px_0_rgb(0,0,0,0.1)] text-lg md:text-xl font-bold hover:-translate-y-1 transition active:translate-y-1 active:shadow-none mb-1.5 md:mb-2 ${isVowel ? 'bg-pink-100 text-pink-500' : 'bg-blue-100 text-blue-500'}`;
                    btn.innerText = char;
                    btn.onclick = () => { this.speak(char); this.typeSpellingLetter(char); };
                    keyboard.appendChild(btn);
                });
            },
            typeSpellingLetter(char) {
                const idx = this.state.spellingInput.findIndex(val => val === '');
                if (idx !== -1) {
                    this.state.spellingInput[idx] = char;
                    const slot = document.getElementById(`slot-${idx}`);
                    slot.innerText = char;
                    const sizeClass = this.state.currentWord.letters.length > 5 ? 'w-8 h-10 md:w-12 md:h-16 text-xl md:text-2xl' : 'w-10 h-12 md:w-16 md:h-20 text-2xl md:text-3xl';
                    slot.className = `${sizeClass} bg-white border-2 border-orange-300 rounded-lg md:rounded-xl flex items-center justify-center font-bold text-orange-500 cursor-pointer transition shadow-md transform scale-105`;
                    if (!this.state.spellingInput.includes('')) this.checkSpelling();
                }
            },
            removeSpellingLetter(index) {
                if (this.state.spellingInput[index] !== '') {
                    this.state.spellingInput[index] = '';
                    const slot = document.getElementById(`slot-${index}`);
                    slot.innerText = '';
                    const sizeClass = this.state.currentWord.letters.length > 5 ? 'w-8 h-10 md:w-12 md:h-16 text-xl md:text-2xl' : 'w-10 h-12 md:w-16 md:h-20 text-2xl md:text-3xl';
                    slot.className = `${sizeClass} bg-gray-100 border-2 border-gray-300 rounded-lg md:rounded-xl flex items-center justify-center font-bold text-gray-700 cursor-pointer transition`;
                }
            },
            checkSpelling() {
                if (this.state.spellingInput.join('') === this.state.currentWord.letters.join('')) {
                    this.speak('Hebat! ' + this.state.currentWord.text);
                    this.fireConfetti();
                    this.addScore(20);
                    setTimeout(() => this.showModal(), 1000);
                } else {
                    this.speak('Coba lagi');
                    const slots = document.getElementById('spelling-slots');
                    slots.animate([{ transform: 'translateX(0)' }, { transform: 'translateX(-5px)' }, { transform: 'translateX(5px)' }, { transform: 'translateX(0)' }], { duration: 300 });
                }
            },
            loadReading() {
                this.state.readingFlipped = false;
                document.getElementById('reading-card-inner').classList.remove('flipped');
                const allWords = [...gameData.syllableWords, ...gameData.cvcWords, ...gameData.trisyllableWords];
                const data = allWords[Math.floor(Math.random() * allWords.length)];
                this.state.currentWord = data;
                const textEl = document.getElementById('reading-text');
                textEl.innerText = data.text;
                textEl.className = data.text.length > 7 ? 'text-3xl md:text-4xl font-bold text-gray-800 tracking-wide break-words' : 'text-4xl md:text-5xl font-bold text-gray-800 tracking-wide break-words';
                document.getElementById('reading-emoji').innerText = data.emoji;
            },
            flipReadingCard() {
                if (!this.state.readingFlipped) {
                    document.getElementById('reading-card-inner').classList.add('flipped');
                    this.state.readingFlipped = true;
                    this.speak(this.state.currentWord.text);
                    this.fireConfetti();
                    this.addScore(15);
                } else {
                    this.speak(this.state.currentWord.text);
                }
            },
            nextReadingCard() { this.loadReading(); },
            addScore(pts) {
                this.state.score += pts;
                const el = this.el.scoreDisplay;
                el.innerText = this.state.score;
                el.parentElement.classList.add('scale-125');
                setTimeout(() => el.parentElement.classList.remove('scale-125'), 300);
            },
            showModal() { document.getElementById('modal-feedback').classList.replace('hidden', 'flex'); },
            closeModal() {
                document.getElementById('modal-feedback').classList.replace('flex', 'hidden');
                if (this.state.currentView === 'spelling') this.loadSpelling();
            },
            resizeCanvas() {
                const c = document.getElementById('confetti-canvas');
                c.width = window.innerWidth;
                c.height = window.innerHeight;
            },
            fireConfetti() {
                const colors = ['#d946ef', '#0ea5e9', '#f59e0b', '#10b981'];
                let particles = [];
                for(let i=0; i<80; i++) {
                    particles.push({
                        x: window.innerWidth/2, y: window.innerHeight/2,
                        r: Math.random()*6+2,
                        dx: (Math.random()-0.5)*15, dy: (Math.random()-0.5)*15,
                        color: colors[Math.floor(Math.random()*colors.length)],
                        life: 100
                    });
                }
                const animate = () => {
                    const ctx = this.confettiCtx;
                    ctx.clearRect(0,0, window.innerWidth, window.innerHeight);
                    particles.forEach((p,i) => {
                        p.x += p.dx; p.y += p.dy; p.dy += 0.3; p.life--;
                        ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
                        ctx.fillStyle = p.color; ctx.fill();
                        if(p.life <= 0) particles.splice(i,1);
                    });
                    if(particles.length) requestAnimationFrame(animate);
                };
                animate();
            }
        };

        window.onload = () => app.init();
    </script>
</body>
</html>